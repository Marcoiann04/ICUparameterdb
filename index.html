<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Estrazione tabella con AI simulata</title>
<style>
  textarea { width: 100%; height: 120px; }
  table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
</style>
</head>
<body>

<h1>Estrazione tabella da testo OCR</h1>

<textarea id="ocrText" placeholder="Incolla qui il testo OCR..."></textarea><br>
<button onclick="estraiDati()">Estrai dati</button>

<h2>Risultato</h2>
<div id="output"></div>

<script>
// Parametri da estrarre in ordine
const parametri = [
  "PA",       // da dividere in sistolica + diastolica
  "MAP",
  "Fc ritmo",
  "PVC",
  "PAP max",
  "PAP min",
  "PAP media",
  "T perif/int",
  "Sat O2",
  "Diuresi oraria"
];

// Funzione che simula un parsing “intelligente” dal testo
function estraiDati() {
  const text = document.getElementById("ocrText").value;
  // Divido il testo in righe
  const righe = text.split("\n").map(r => r.trim()).filter(r => r.length > 0);

  // Array per salvare dati
  let dati = {};

  // Contatore per parametri (perchè non ci sono nomi per ogni riga, si va per ordine)
  let indexParam = 0;

  // Scorro righe e cerco numeri
  for(let r of righe) {
    if(indexParam >= parametri.length) break; // finito

    // Trovo i numeri nella riga
    let numeri = r.match(/(\d+(\.\d+)?|(\d+\/\d+)|(\d+,\d+))/g);
    if(!numeri) continue;

    // Speciale per PA: ha 2 numeri, sistolica e diastolica
    if(parametri[indexParam] === "PA" && numeri.length >= 2) {
      dati["PA sistolica"] = numeri[0].replace(",", ".");
      dati["PA diastolica"] = numeri[1].replace(",", ".");
      indexParam++;
      continue;
    }

    // Per PAP che si divide in max, min e media prendiamo una riga alla volta
    if(parametri[indexParam].startsWith("PAP")) {
      dati[parametri[indexParam]] = numeri[0].replace(",", ".");
      indexParam++;
      continue;
    }

    // Per tutti gli altri prendo il primo numero trovato
    dati[parametri[indexParam]] = numeri[0].replace(",", ".");
    indexParam++;
  }

  // Costruisco tabella HTML da mostrare
  let html = "<table><thead><tr><th>Parametro</th><th>Valore</th></tr></thead><tbody>";
  for(let p of parametri) {
    html += `<tr><td>${p}</td><td>${dati[p] || ""}</td></tr>`;
  }
  html += "</tbody></table>";

  document.getElementById("output").innerHTML = html;
}

</script>
</body>
</html>
