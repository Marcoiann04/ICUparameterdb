<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Estrazione Parametri Vitali</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: auto; }
    textarea, input[type="text"] { width: 100%; margin-top: 10px; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .parametri { margin-top: 20px; }
    .button { margin-top: 15px; padding: 10px; background: #2a7; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Estrazione Parametri da Immagine</h2>

  <input type="file" id="imageInput" accept="image/*">
  <button class="button" onclick="estraiTesto()">Estrai parametri</button>

  <h3>Testo estratto:</h3>
  <textarea id="outputOCR" rows="10"></textarea>

  <h3>Valori corretti (incolla da Excel):</h3>
  <textarea id="valoriCorretti" rows="10" placeholder="Incolla qui i valori veri in ordine..."></textarea>

  <button class="button" onclick="salvaNelDatabase()">Salva per apprendimento</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDMwhn0T4E9MjFIPjtoDaEBn2J6B3c9Zc8",
      authDomain: "icuparameters.firebaseapp.com",
      projectId: "icuparameters",
      storageBucket: "icuparameters.appspot.com",
      messagingSenderId: "967179535774",
      appId: "1:967179535774:web:5f1e077c8a37c5822f828f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.estraiTesto = () => {
      const imageInput = document.getElementById('imageInput');
      const outputOCR = document.getElementById('outputOCR');

      if (!imageInput.files[0]) return alert("Seleziona un'immagine");

      Tesseract.recognize(
        imageInput.files[0],
        'eng',
        { logger: m => console.log(m) }
      ).then(({ data: { text } }) => {
        outputOCR.value = text;
      });
    };

    window.salvaNelDatabase = async () => {
      const testoOCR = document.getElementById('outputOCR').value;
      const valoriCorretti = document.getElementById('valoriCorretti').value;

      if (!testoOCR.trim() || !valoriCorretti.trim()) {
        return alert("Compila entrambi i campi");
      }

      try {
        await addDoc(collection(db, "campioni"), {
          ocr: testoOCR,
          corretti: valoriCorretti,
          timestamp: new Date()
        });
        alert("Dati salvati per l'apprendimento");
      } catch (e) {
        console.error("Errore nel salvataggio:", e);
        alert("Errore nel salvataggio dei dati");
      }
    };
  </script>
</body>
</html>


