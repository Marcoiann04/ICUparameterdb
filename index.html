<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Estrazione parametri vitali da immagine</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 100px;
    }
    .output {
      white-space: pre-wrap;
      background-color: #f3f3f3;
      padding: 10px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    .highlight {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Estrazione parametri vitali da immagine</h1>
  <input type="file" id="imageInput" accept="image/*">
  <button onclick="extractText()">Estrai parametri</button>

  <div class="output" id="output"></div>

  <script>
    async function extractText() {
      const image = document.getElementById('imageInput').files[0];
      if (!image) {
        alert("Carica un'immagine prima!");
        return;
      }

      document.getElementById('output').textContent = "Estrazione in corso...";

      const result = await Tesseract.recognize(image, 'eng', {
        logger: m => console.log(m)
      });

      const text = result.data.text;

      // Elabora il testo per estrarre i parametri
      const righe = text.split('\n').map(r => r.trim()).filter(r => r.length > 0);

      // Prende le righe utili: primi 8 blocchi (PA fino a SatO2), salta 4, poi Diuresi
      const parametriUtili = [
        righe[0] || '',  // PA
        righe[1] || '',  // MAP
        righe[2] || '',  // FC Ritmo
        righe[3] || '',  // PVC
        righe[4] || '',  // PAP max
        righe[5] || '',  // PAP min
        righe[6] || '',  // PAP media
        righe[7] || '',  // Temperatura
        righe[12] || '', // Sat O2
        righe[17] || '', // Diuresi oraria (dopo 4 righe da saltare)
      ];

      // Mostra i risultati in formato Excel-friendly
      const output = 
        `Parametro\tValore\n` +
        `PA Max\t${parametriUtili[0].split('\n')[0] || parametriUtili[0]}\n` +
        `PA Min\t${parametriUtili[0].split('\n')[1] || ''}\n` +
        `MAP\t${parametriUtili[1]}\n` +
        `FC Ritmo\t${parametriUtili[2]}\n` +
        `PVC\t${parametriUtili[3]}\n` +
        `PAP Max\t${parametriUtili[4]}\n` +
        `PAP Min\t${parametriUtili[5]}\n` +
        `PAP Media\t${parametriUtili[6]}\n` +
        `Temperatura\t${parametriUtili[7]}\n` +
        `Sat O2\t${parametriUtili[8]}\n` +
        `Diuresi oraria\t${parametriUtili[9]}`;

      document.getElementById('output').textContent = output;
    }
  </script>
</body>
</html>


