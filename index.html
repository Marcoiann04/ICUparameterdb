<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OCR Valori Tabulati</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; padding: 20px; }
    input, button, textarea { font-size: 1rem; width: 100%; margin-top: 10px; }
    #output { white-space: pre; font-family: monospace; margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
    .hidden { display: none; }
  </style>
</head>
<body>

<h2>Estrai Valori da Screenshot</h2>

<input type="file" id="imgInput" accept="image/*" />
<button id="btnExtract">Estrai Valori</button>

<div id="output"></div>

<script>
  document.getElementById('btnExtract').addEventListener('click', async () => {
    const fileInput = document.getElementById('imgInput');
    const output = document.getElementById('output');
    output.textContent = "Estrazione in corso...";

    if (!fileInput.files || fileInput.files.length === 0) {
      output.textContent = "Seleziona un'immagine.";
      return;
    }

    const file = fileInput.files[0];

    try {
      const result = await Tesseract.recognize(file, 'ita', {
        logger: m => console.log(m)
      });

      const text = result.data.text;

      // Estrai solo numeri (anche con virgola o punto)
      const numeri = text.match(/[\d]+(?:[.,]\d+)?/g);
      if (!numeri || numeri.length === 0) {
        output.textContent = "Nessun numero rilevato.";
        return;
      }

      const tabulati = numeri.map(n => n.replace(',', '.')).join('\t');
      output.textContent = tabulati;

    } catch (err) {
      output.textContent = "Errore nell'elaborazione OCR: " + err.message;
      console.error(err);
    }
  });
</script>

</body>
</html>

