



<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Estrazione Parametri OCR</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  textarea { width: 100%; height: 150px; }
  pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; word-wrap: break-word; }
</style>
</head>
<body>

<h2>Carica immagine con parametri</h2>
<input type="file" id="imageInput" accept="image/*" />
<button id="startOcr">Estrai e Mostra</button>

<h3>Risultato estrazione</h3>
<pre id="resultArea">Nessun risultato ancora.</pre>

<script>
// Funzione di estrazione parametri dal testo OCR
function parseOcrText(text) {
  const keys = [
    "PA Max", "PA Min", "MAP", "FC Ritmo", "PVC",
    "PAP Max", "PAP Min", "PAP Media", "Temperatura",
    "Sat O2", "Diuresi oraria"
  ];

  let lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
  let allNumbers = [];

  for(let line of lines) {
    let nums = line.match(/\d+[.,]?\d*/g);
    if(nums) {
      nums = nums.map(n => n.replace(',', '.'));
      allNumbers.push(...nums);
    }
  }

  if(allNumbers.length < keys.length) return null;

  let extracted = {};
  for(let i=0; i<keys.length; i++) {
    extracted[keys[i]] = allNumbers[i];
  }
  return extracted;
}

function formatExtracted(extracted) {
  if(!extracted) return "Nessun dato estratto o dati insufficienti.";
  let header = Object.keys(extracted).join('\t');
  let values = Object.values(extracted).join('\t');
  return header + '\n' + values;
}

document.getElementById('startOcr').addEventListener('click', () => {
  let fileInput = document.getElementById('imageInput');
  let resultArea = document.getElementById('resultArea');
  if(fileInput.files.length === 0) {
    alert("Seleziona prima un'immagine.");
    return;
  }
  resultArea.textContent = "OCR in corso, attendi...";
  let file = fileInput.files[0];

  Tesseract.recognize(
    file,
    'ita',
    { logger: m => console.log(m) }
  ).then(({ data: { text } }) => {
    console.log("Testo OCR grezzo:", text);
    let estratto = parseOcrText(text);
    let output = formatExtracted(estratto);
    resultArea.textContent = output;
  }).catch(err => {
    console.error(err);
    resultArea.textContent = "Errore durante l'OCR.";
  });
});
</script>

</body>
</html>

